**How to run unit tests?**
============================

Tests are stored in the `tests` directory. 
 - directories `tests/resources/` expose testing files including FASTQ, SAM, VCF formats 
 - files `tests/test_*` are scripts that tests this project
  
 Procedure should be performed within the same terminal session. 
### 1. Set the environment variable
Open the terminal and run:
```bash 
export AIRFLOW__CORE__UNIT_TEST_MODE=true
```
This change the Airflow mode to UnitTest mode.

You should provide an absolute path to the Seqtender JAR file and set it as the environment variable `SEQTENDER_JAR` .

Tests performed for VEP operators are perfomed using 98 version. You should provied the absolute path to the VEP cache as the the environment variable `VEP_CACHE_98`.

By default tests resolves an absolute path to the Cannoli JAR file (stored in the `tools/target/scala-2.12/BioPipeline-assembly-0.2-SNAPSHOT.jar` directory), but it can be set as the environement variable`CANNOLI_JAR`. 

### 2.Prepare unittests.db
`Unittests.db` is a database automatically generated by Airflow. You should update this database with our testing settings that are stored in `tests/resources/configtest.json`
Run:

``` bash
airflow variables -i tests/resources/configtest.json
```
---
**NOTE**

It may happen that some of the dependencies for the biopipeline are already configured in this database which may impact on the tests results. It is not recommended to insert any values manually.  

---

### 3.Run unit tests

Run: 
``` bash
 python3 -m unittest test_spark_config_operator test_cannoli_operators test_static test_dynamic test_seqtender_operators
```


